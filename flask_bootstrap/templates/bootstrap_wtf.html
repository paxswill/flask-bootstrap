{% macro description_or_errors(field) %}
{% for error in field.errors %}
<p class="help-block">{{ error }}</p>
{% else %}
{% if field.description %}
<p class="help-block">{{ field.description|safe }}</p>
{% endif %}
{% endfor %}
{% endmacro %}

{%- macro inline_field(field) %}
{%- with required = "required" if kwargs['required'] or field.flags.required else "" -%}
{{field(placeholder=field.label.text, required=required, **kwargs)}}
{%- endwith %}
{%- endmacro %}

{%- macro horizontal_field(field) %}
<div class="control-group {% if field.errors %}error{% endif %}">
  {{field.label(class="control-label")}}
  <div class="controls">
    {{field(**kwargs)|safe}}
    {{ description_or_errors(field) }}
  </div>
</div>
{% endmacro %}

{% macro default_field(field) %}
{{ field.label }}{{ field }}{{ description_or_errors(field) }}
{% endmacro %}

{%- macro form_actions(form) %}
<div class="form-actions">
  {% for field in form if field is button(submit='only') %}
  {{ field }}
  {%- endfor %}
  {% for field in form if field is button(submit=False) %}
  {{ field }}
  {%- endfor %}
</div>
{%- endmacro %}

{% macro form_errors(form, hiddens=True) %}
{%- if form.errors %}
{%- for fieldname, errors in form.errors.iteritems() if form[fieldname] is hidden %}
{%- if hiddens or hiddens != 'only' %}
{%- for error in errors %}
<p class="error">{{error}}</p>
{%- endfor %}
{%- endif %}
{%- endfor %}
{%- endif %}
{%- endmacro %}

{% macro quick_form(form, action=".", method="post", class="form form-horizontal") %}
<form action="{{action}}" method="post" class="{{class}}">
  {{ form.hidden_tag() }}
  {{ form_errors(form, 'only') }}
  {%- for field in form if (field is not hidden and field is not button) %}
  {% if 'form-horizontal' in class %}
  {{ horizontal_field(field) }}
  {% elif 'form-inline' in class %}
  {{ inline_field(field) }}
  {% else %}
  {{ default_field(field) }}
  {% endif %}
  {%- endfor %}
  {% if 'form-inline' in class %}
  {% for field in form if field is button(submit='only') %}
  {{ field }}
  {% endfor %}
  {% for field in form if field is button(submit=False) %}
  {{ field }}
  {% endfor %}
  {% else %}
  {{ form_actions(form) }}
  {% endif %}
</form>
{%- endmacro %}
